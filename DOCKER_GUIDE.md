# ğŸ³ Docker ì‹¤í–‰ ê°€ì´ë“œ

## ë¹ ë¥¸ ì‹œì‘

### 1. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

`.env` íŒŒì¼ì„ í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— ìƒì„±í•˜ì„¸ìš”:

```bash
OPENAI_API_KEY=your_api_key_here
```

### 2. Docker Composeë¡œ ì‹¤í–‰

```bash
# ë¹Œë“œ ë° ì‹¤í–‰
docker-compose up --build

# ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰
docker-compose up -d

# ë¡œê·¸ í™•ì¸
docker-compose logs -f

# ì¤‘ì§€
docker-compose down
```

### 3. ì¼ë°˜ Docker ëª…ë ¹ì–´ë¡œ ì‹¤í–‰

```bash
# ì´ë¯¸ì§€ ë¹Œë“œ
docker build -t agent-api .

# ì»¨í…Œì´ë„ˆ ì‹¤í–‰
docker run -p 8000:8000 \
  --env-file .env \
  agent-api

# ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰
docker run -d -p 8000:8000 \
  --env-file .env \
  --name agent-api \
  agent-api
```

---

## ğŸ§ª Docker ì»¨í…Œì´ë„ˆ í…ŒìŠ¤íŠ¸

Dockerë¡œ API ì„œë²„ë¥¼ ì‹¤í–‰í•œ í›„, **ë¡œì»¬ ë¨¸ì‹ **ì—ì„œ í…ŒìŠ¤íŠ¸ í´ë¼ì´ì–¸íŠ¸ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ë°©ë²• 1: Python í´ë¼ì´ì–¸íŠ¸ (ë¡œì»¬ì—ì„œ ì‹¤í–‰)

```bash
# ë¡œì»¬ ë¨¸ì‹ ì—ì„œ ì‹¤í–‰
python test_stream_client.py
```

ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” `http://localhost:8000`ìœ¼ë¡œ ìš”ì²­ì„ ë³´ë‚´ë¯€ë¡œ, Docker ì»¨í…Œì´ë„ˆê°€ 8000ë²ˆ í¬íŠ¸ë¡œ ì‹¤í–‰ ì¤‘ì´ë©´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤.

### ë°©ë²• 2: HTML í´ë¼ì´ì–¸íŠ¸ (ë¸Œë¼ìš°ì €ì—ì„œ ì‹¤í–‰)

```bash
# ë¸Œë¼ìš°ì €ì—ì„œ ì—´ê¸°
open test_stream_client.html
# ë˜ëŠ”
firefox test_stream_client.html
```

HTML íŒŒì¼ì€ ë¡œì»¬ ë¸Œë¼ìš°ì €ì—ì„œ ì‹¤í–‰ë˜ë©°, Docker ì»¨í…Œì´ë„ˆì˜ API(`http://localhost:8000`)ì— ì ‘ê·¼í•©ë‹ˆë‹¤.

### ë°©ë²• 3: cURL (ë¡œì»¬ í„°ë¯¸ë„ì—ì„œ ì‹¤í–‰)

```bash
# ìŠ¤íŠ¸ë¦¬ë° í…ŒìŠ¤íŠ¸
curl -N -X POST http://localhost:8000/agent/stream \
  -H "Content-Type: application/json" \
  -d '{"message": "ì•ˆë…•í•˜ì„¸ìš”"}'

# ì¼ë°˜ ìš”ì²­ í…ŒìŠ¤íŠ¸
curl -X POST http://localhost:8000/agent \
  -H "Content-Type: application/json" \
  -d '{"message": "ì•ˆë…•í•˜ì„¸ìš”"}'
```

---

## ğŸ“Š ì•„í‚¤í…ì²˜ (Docker í™˜ê²½)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ë¡œì»¬ ë¨¸ì‹          â”‚
â”‚                     â”‚
â”‚  â€¢ ë¸Œë¼ìš°ì €         â”‚â—„â”€â”€â”€ test_stream_client.html
â”‚  â€¢ Python í´ë¼ì´ì–¸íŠ¸ â”‚â—„â”€â”€â”€ test_stream_client.py
â”‚  â€¢ cURL             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ http://localhost:8000
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Docker Container   â”‚
â”‚                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ FastAPI       â”‚  â”‚
â”‚  â”‚ (port 8000)   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚          â”‚          â”‚
â”‚          â–¼          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ LangGraph     â”‚  â”‚
â”‚  â”‚ Agent System  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**í¬ì¸íŠ¸**: 
- **Docker ì»¨í…Œì´ë„ˆ**: API ì„œë²„ë§Œ ì‹¤í–‰
- **ë¡œì»¬ ë¨¸ì‹ **: í…ŒìŠ¤íŠ¸ í´ë¼ì´ì–¸íŠ¸ ì‹¤í–‰
- **í¬íŠ¸ ë§¤í•‘**: Dockerì˜ 8000ë²ˆ í¬íŠ¸ê°€ ë¡œì»¬ì˜ 8000ë²ˆ í¬íŠ¸ë¡œ ë§¤í•‘ë¨

---

## ğŸ”§ ê³ ê¸‰ ì„¤ì •

### ë‹¤ë¥¸ í¬íŠ¸ ì‚¬ìš©

ë¡œì»¬ì˜ 8000ë²ˆ í¬íŠ¸ê°€ ì‚¬ìš© ì¤‘ì´ë©´ ë‹¤ë¥¸ í¬íŠ¸ë¡œ ë§¤í•‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

**docker-compose.yml ìˆ˜ì •:**
```yaml
ports:
  - "8080:8000"  # ë¡œì»¬ 8080 â†’ ì»¨í…Œì´ë„ˆ 8000
```

**í…ŒìŠ¤íŠ¸ ì‹œ URL ë³€ê²½:**
```bash
# Python í´ë¼ì´ì–¸íŠ¸ì—ì„œ
API_URL = 'http://localhost:8080'

# cURLì—ì„œ
curl http://localhost:8080/agent/stream ...
```

### ê°œë°œ ëª¨ë“œ (ì½”ë“œ ë³€ê²½ ìë™ ë°˜ì˜)

docker-compose.ymlì— ì´ë¯¸ ë³¼ë¥¨ ë§ˆìš´íŠ¸ê°€ ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤:

```yaml
volumes:
  - ./src:/app/src
```

ì½”ë“œë¥¼ ìˆ˜ì •í•˜ë©´ ì»¨í…Œì´ë„ˆë¥¼ ì¬ì‹œì‘í•´ì•¼ í•©ë‹ˆë‹¤:

```bash
docker-compose restart
```

ë˜ëŠ” hot-reloadë¥¼ ìœ„í•´ `src/main.py`ë¥¼ ìˆ˜ì •:

```python
if __name__ == '__main__':
    uvicorn.run(app, host="0.0.0.0", port=8000, reload=True)
```

### ë¡œê·¸ í™•ì¸

```bash
# ì‹¤ì‹œê°„ ë¡œê·¸
docker-compose logs -f

# íŠ¹ì • ì„œë¹„ìŠ¤ ë¡œê·¸
docker-compose logs -f agent-api

# ì¼ë°˜ Docker
docker logs -f agent-api
```

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### 1. .env íŒŒì¼ í•„ìˆ˜

Docker ì‹¤í–‰ ì „ `.env` íŒŒì¼ì´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤:

```bash
# .env íŒŒì¼ì´ ì—†ìœ¼ë©´ ìƒì„±
echo "OPENAI_API_KEY=your_key_here" > .env
```

### 2. í¬íŠ¸ ì¶©ëŒ

8000ë²ˆ í¬íŠ¸ê°€ ì´ë¯¸ ì‚¬ìš© ì¤‘ì´ë©´ ì—ëŸ¬ê°€ ë°œìƒí•©ë‹ˆë‹¤. ë‹¤ë¥¸ í¬íŠ¸ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ ê¸°ì¡´ í”„ë¡œì„¸ìŠ¤ë¥¼ ì¢…ë£Œí•˜ì„¸ìš”:

```bash
# 8000ë²ˆ í¬íŠ¸ ì‚¬ìš© ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ í™•ì¸ (macOS/Linux)
lsof -i :8000

# í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ
kill -9 <PID>
```

### 3. CORS ì´ìŠˆ

ë¸Œë¼ìš°ì €ì—ì„œ í…ŒìŠ¤íŠ¸ ì‹œ CORS ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´, `src/main.py`ì˜ CORS ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”. í˜„ì¬ëŠ” ëª¨ë“  originì„ í—ˆìš©í•˜ë„ë¡ ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

---

## ğŸš€ í”„ë¡œë•ì…˜ ë°°í¬

### AWS ECS ë°°í¬ ì˜ˆì‹œ

`ecs-task-definition.json`ì„ ì‚¬ìš©í•˜ì—¬ ECSì— ë°°í¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```bash
# ECRì— ì´ë¯¸ì§€ í‘¸ì‹œ
aws ecr get-login-password --region us-east-1 | docker login --username AWS --password-stdin <account-id>.dkr.ecr.us-east-1.amazonaws.com
docker tag agent-api:latest <account-id>.dkr.ecr.us-east-1.amazonaws.com/agent-api:latest
docker push <account-id>.dkr.ecr.us-east-1.amazonaws.com/agent-api:latest

# ECS íƒœìŠ¤í¬ ë“±ë¡
aws ecs register-task-definition --cli-input-json file://ecs-task-definition.json
```

### í™˜ê²½ ë³€ìˆ˜ ë³´ì•ˆ

í”„ë¡œë•ì…˜ì—ì„œëŠ” `.env` íŒŒì¼ ëŒ€ì‹  ì•ˆì „í•œ ë°©ë²•ì„ ì‚¬ìš©í•˜ì„¸ìš”:

- **AWS ECS**: Secrets Manager ë˜ëŠ” Parameter Store
- **Kubernetes**: Secrets
- **Docker**: `--env` í”Œë˜ê·¸ë¡œ ì§ì ‘ ì „ë‹¬

---

## ğŸ“ ìš”ì•½

âœ… **Dockerë¡œ API ì„œë²„ë¥¼ ì‹¤í–‰**í•˜ë©´:
- ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ FastAPI ì„œë²„ê°€ 8000ë²ˆ í¬íŠ¸ë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤
- ë¡œì»¬ ë¨¸ì‹ ì˜ 8000ë²ˆ í¬íŠ¸ë¡œ ë§¤í•‘ë©ë‹ˆë‹¤
- `http://localhost:8000`ìœ¼ë¡œ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤

âœ… **í…ŒìŠ¤íŠ¸ í´ë¼ì´ì–¸íŠ¸ëŠ” ë¡œì»¬ì—ì„œ ì‹¤í–‰**:
- `test_stream_client.py` (Python ìŠ¤í¬ë¦½íŠ¸)
- `test_stream_client.html` (ë¸Œë¼ìš°ì €)
- cURL (í„°ë¯¸ë„)

âœ… **ë‘˜ì€ ë„¤íŠ¸ì›Œí¬ë¡œ ì—°ê²°**:
- Docker í¬íŠ¸ ë§¤í•‘ (`-p 8000:8000`)ì„ í†µí•´ í†µì‹ í•©ë‹ˆë‹¤

